
## Micro game service packet envelope

  1 2 3 4
+ - - - - +
|   len   |
+- - - - - - - + - - - - - - -+
|    Data ... len bytes ...   |
+- - - - - - - + - - - - - - -+

## Micro game service communication
                                                                (external)
+-------+                   +--------------+                 +--------------+
| Party |                   | Game Manager |                 | Game Service |
+-------+                   +--------------+                 +--------------+
    |                              |                                |
    | Incoming message             |                                |
    |----------------------------->|                                |
    |                              |                                |
    |                              | Get last state                 |
    |                              |---------------                 |
    |                              |              |                 |
    |                              |<--------------                 |
    |                              |                                |
    |                              | Compile game update            |
    |                              |----------------------          |
    |                              |                     |          |
    |                              |   proto:game_update |          |
    |                              |<---------------------          |
    |                              |                                |
    |                              | Update packet envelope         |
    |                              |------------------------------->|
    |                              |                                |
    |                              |               proto:game_state |
    |                              |<-------------------------------|
    |                              |                                |
    |                              | Store state                    |
    |                              |-------------                   |
    |                              |            |                   |
    |                              |<------------                   |
    |                              |                                |
    |         Broadcast game state |                                |
    |<-----------------------------|                                |
    |                              |                                |

## Hosting a Party

+--------+                  +---------------+                 +-------+
| Client |                  | Party Manager |                 | Party |
+--------+                  +---------------+                 +-------+
     |                             |                              |
     | Connect                     |                              |
     |---------------------------->|                              |
     |                             |                              |
     | Host                        |                              |
     |---------------------------->|                              |
     |                             |                              |
     |                             | Create Party                 |
     |                             |------------                  |
     |                             |           |                  |
     |                             |<-----------                  |
     |                             |                              |
     |                             | Register Party               |
     |                             |-----------------             |
     |                             |                |             |
     |                             |     Party Code |             |
     |                             |<----------------             |
     |                             |                              |
     |                             | Connect:Host                 |
     |                             |----------------------------->|
     |                             |                              |
     |                             |        Connected:GameDetails |
     |                             |<-----------------------------|
     |                             |                              |
     |       Connected:GameDetails |                              |
     |<----------------------------|                              |
     |                             |                              |

## Joining a Party

+--------+                  +---------------+                 +-------+
| Client |                  | Party Manager |                 | Party |
+--------+                  +---------------+                 +-------+
     |                             |                              |
     | Connect                     |                              |
     |---------------------------->|                              |
     |                             |                              |
     | Join:PartyCode              |                              |
     |---------------------------->|                              |
     |                             |                              |
     |                             | Validate PartyCode           |
     |                             |------------                  |
     |                             |           |                  |
     |                             |<-----------                  |
     |                             |                              |
     |                             | Determine Party              |
     |                             |-----------------             |
     |                             |                |             |
     |                             |<----------------             |
     |                             |                              |
     |                             | Connect:Client               |
     |                             |----------------------------->|
     |                             |                              |
     |                             |        Connected:GameDetails |
     |                             |<-----------------------------|
     |                             |                              |
     |       Connected:GameDetails |                              |
     |<----------------------------|                              |
     |                             |                              |

##
